<!DOCTYPE html>
<!--
===================================================================================
ARQUIVO PRINCIPAL DA APLICA√á√ÉO - Minhas Mem√≥rias
===================================================================================
Este arquivo HTML serve como o ponto de entrada √∫nico para a aplica√ß√£o principal.
Ele define a estrutura do layout, importa todas as depend√™ncias (CSS, JS, Fontes)
e cont√©m os cont√™ineres para todos os modais que s√£o exibidos dinamicamente.

Estrutura Geral:
- <head>: Cont√©m metadados, links para folhas de estilo, fontes e importa√ß√£o de
           bibliotecas de terceiros como Firebase, SortableJS, e Chart.js.
- <body>: Cont√©m a estrutura vis√≠vel da p√°gina.
  - #appScreen: A tela principal da aplica√ß√£o que √© mostrada para usu√°rios logados.
    - <header>: Cabe√ßalho fixo com o logo, menu de navega√ß√£o e a√ß√µes do usu√°rio.
    - #notes-container: Onde os post-its s√£o renderizados dinamicamente.
    - .floating-add-btn: Bot√£o flutuante para adicionar novas notas.
  - Modais: Uma s√©rie de divs com a classe `.modal-overlay`. Cada uma representa
            um modal diferente (nova nota, confirma√ß√£o, gerenciamento, etc.).
            Eles ficam ocultos por padr√£o e s√£o ativados via JavaScript.
  - Scripts: A importa√ß√£o dos scripts da aplica√ß√£o, com o atributo `defer` para
             garantir que o HTML seja parseado antes da execu√ß√£o dos scripts.
===================================================================================
-->
<html lang="pt-BR">
<head>
  <!-- Metadados essenciais -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minhas Mem√≥rias</title>

  <!-- === DEPEND√äNCIAS DE TERCEIROS === -->
  <!-- Firebase SDK (Software Development Kit) -->
  <!-- Importa os servi√ßos do Firebase necess√°rios: app (n√∫cleo), auth (autentica√ß√£o), firestore (banco de dados) e messaging (notifica√ß√µes). -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging-compat.js"></script>

  <!-- Script de inicializa√ß√£o do Firebase Messaging -->
  <script src="firebase/firebase-messaging-init.js"></script>

  <!-- SortableJS: Biblioteca para criar listas arrast√°veis (drag-and-drop). Usada para reordenar abas e notas. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <!-- Font Awesome: Biblioteca de √≠cones. -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts: Para a tipografia com estilo de m√°quina de escrever. -->
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Typewriter&display=swap" rel="stylesheet">

  <!-- Manifest e Favicon: Essenciais para Progressive Web App (PWA) e identidade visual. -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="IMG/favicon.png" type="image/png">

  <!-- Chart.js: Biblioteca para criar gr√°ficos, usada no painel de administra√ß√£o. -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- === ESTILOS DA APLICA√á√ÉO === -->
  <!-- A ordem √© importante: main (base), postit, modal (componentes), responsive (ajustes finais). -->
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/postit.css">
  <link rel="stylesheet" href="styles/modal.css">
  <link rel="stylesheet" href="styles/responsive.css">
</head>
<body>

  <!-- =============================================================================== -->
  <!-- TELA PRINCIPAL DA APLICA√á√ÉO (#appScreen)                                        -->
  <!-- =============================================================================== -->
  <!-- Esta √© a view principal que o usu√°rio v√™ ap√≥s o login. -->
  <div id="appScreen" class="screen">

    <!-- Cabe√ßalho Fixo -->
    <header>
      <!-- Barra Superior: Cont√©m logo, menu e a√ß√µes prim√°rias. -->
      <div class="top-bar">
        <div class="logo-area">
          <span id="appName"><i class="fas fa-brain"></i> Minhas Memorias</span>
          <!-- Cont√™iner para exibir o uso de mem√≥ria (notas usadas / limite). -->
          <div id="memoryUsageDisplayContainer">Memorias Usadas: <span id="usedMemoryCount">-</span>/<span id="totalMemoryLimit">-</span></div>
        </div>
        <!-- Bot√µes de a√ß√£o que aparecem em diferentes tamanhos de tela. -->
        <button id="mobilePessoaisBtn" class="mobile-action-btn" title="Acessar Pessoais"><i class="fas fa-user"></i></button>
        <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
        <!-- Menu Colaps√°vel (hamb√∫rguer em mobile, vis√≠vel em desktop) -->
        <div class="collapsible-menu">
          <nav class="main-nav">
            <!-- Dropdown de Categorias/Temas √© populado dinamicamente por JS. -->
            <div class="category-dropdown">
              <button class="dropdown-btn"><span class="btn-text">Categorias</span> <i class="fas fa-chevron-down"></i></button>
              <div class="dropdown-content"></div>
            </div>
          </nav>
          <!-- A√ß√µes do Usu√°rio (Gerenciar Abas, Sair) -->
          <div class="user-actions">
            <button id="headerPessoaisBtn" class="user-action-btn perso-btn"><i class="fas fa-sticky-note"></i> Pessoais</button>
            <button onclick="logout()" class="header-logout-btn-new"><i class="fas fa-sign-out-alt"></i> Sair</button>
          </div>
        </div>
      </div>

      <!-- Barra de Navega√ß√£o Principal (para Abas Pessoais) -->
      <!-- Wrapper para o carrossel. -->
      <div id="navbarWrapper" class="navbar-wrapper">
        <button class="scroll-arrow left-arrow" style="display: none;"><i class="fas fa-chevron-left"></i></button>
        <nav class="navbar" id="navbar"></nav> <!-- Conte√∫do populado por JS. -->
        <button class="scroll-arrow right-arrow" style="display: none;"><i class="fas fa-chevron-right"></i></button>
      </div>

      <!-- Barra de Navega√ß√£o Secund√°ria (para Subtemas) -->
      <!-- Fica oculta (`display:none`) at√© que um tipo de tema seja selecionado. -->
      <div id="secondaryNavbarWrapper" class="navbar-wrapper" style="display:none;">
        <button class="scroll-arrow left-arrow" style="display: none;"><i class="fas fa-chevron-left"></i></button>
        <nav id="secondaryNavbar" class="navbar"></nav> <!-- Conte√∫do populado por JS. -->
        <button class="scroll-arrow right-arrow" style="display: none;"><i class="fas fa-chevron-right"></i></button>
      </div>
    </header>

    <!-- Bot√£o Flutuante de A√ß√£o (FAB) para adicionar nova nota. -->
    <button class="floating-add-btn" onclick="openModal()" title="Adicionar nova mem√≥ria">
      <i class="fas fa-plus icon-plus"></i><i class="fas fa-brain icon-brain"></i>
    </button>

    <!-- Cont√™iner Principal para as Notas (Post-its) -->
    <!-- Este div √© preenchido dinamicamente pelo JavaScript com as notas do usu√°rio. -->
    <div class="notes-container" id="notes"></div>
  </div>

  <!-- Coluna de A√ß√£o Direita para Mobile -->
  <!-- Cont√©m atalhos de √≠cones para categorias em telas pequenas. -->
  <div id="mobileRightActionColumn" style="display:none;position:fixed;bottom:100px;right:20px;z-index:999;flex-direction:column;align-items:center;gap:10px;">
    <div id="mobileCategoryIconsContainer" style="display:flex;flex-direction:column;align-items:center;gap:8px;"></div>
  </div>


  <!-- =============================================================================== -->
  <!-- SE√á√ÉO DE MODAIS (Overlays)                                                      -->
  <!-- =============================================================================== -->
  <!-- Todos os modais s√£o definidos aqui. Eles ocupam a tela inteira com um fundo   -->
  <!-- transl√∫cido e s√£o controlados (exibidos/ocultos) via JavaScript.              -->
  <!-- Usar um ID √∫nico para cada overlay √© uma boa pr√°tica para selecion√°-los.      -->

  <!-- Modal: Adicionar Nova Mem√≥ria -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header"><span><i class="fas fa-sticky-note"></i> Nova Mem√≥ria</span><button class="modal-close-btn" onclick="closeModal()"><i class="fas fa-times"></i></button></div>
      <div class="modal-content">
        <textarea id="noteText" placeholder="‚úçÔ∏è Escreva sua mem√≥ria aqui..."></textarea>
        <div id="themeNoteCustomization"></div> <!-- Para customiza√ß√µes futuras -->
        <div class="modal-date-container"><label for="noteDueDate"><i class="fas fa-calendar-alt"></i> Lembrar em:</label><input type="date" id="noteDueDate"></div>
        <div class="modal-button-group">
          <button onclick="closeModal()" class="cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
          <button onclick="addNote()" class="add-btn"><i class="fas fa-plus"></i> Add Mem√≥ria</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Confirma√ß√£o Gen√©rica (Excluir, etc.) -->
  <div id="confirmationModalOverlay" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header"><span id="confirmationModalTitle">Confirmar A√ß√£o</span><button class="modal-close-btn" onclick="closeConfirmationModal()"><i class="fas fa-times"></i></button></div>
      <div class="modal-content">
        <p id="confirmationModalMessage" style="margin-bottom:20px;font-size:1rem;color:#2c2416;"></p>
        <div class="modal-button-group">
          <button onclick="cancelConfirmation()" class="cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
          <button onclick="confirmAction()" class="add-btn" id="confirmActionButton"><i class="fas fa-check"></i> Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Inserir Nome do Tema (substitu√≠do por um modal mais completo) -->
  <!-- SUGEST√ÉO: Este modal parece ser um legado. Se `manageSubthemesModalOverlay` o substituiu, este pode ser removido para simplificar. -->
  <div id="themeNameModalOverlay" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header"><span id="themeNameModalTitle"></span><button class="modal-close-btn" onclick="closeThemeNameModal()"><i class="fas fa-times"></i></button></div>
      <div class="modal-content"><input type="text" id="themeNameInput" placeholder="Digite o nome aqui..."><div class="modal-button-group"><button onclick="closeThemeNameModal()" class="cancel-btn"><i class="fas fa-times"></i> Cancelar</button><button onclick="saveThemeName()" class="add-btn"><i class="fas fa-save"></i> Salvar</button></div></div>
    </div>
  </div>

  <!-- Modal: Painel de Admin (visualiza√ß√£o r√°pida) -->
  <!-- NOTA: Este modal parece ter sido substitu√≠do por uma p√°gina de dashboard dedicada. Pode ser um legado. -->
  <div id="adminPanelModalOverlay" class="modal-overlay">
    <div class="modal-container admin-modal-container">
      <div class="modal-header"><span><i class="fas fa-user-cog"></i> Painel Administrativo</span><button class="modal-close-btn" onclick="closeAdminModal()"><i class="fas fa-times"></i></button></div>
      <div class="modal-content admin-modal-content"><div class="admin-stats"><p>Usu√°rios Free: <span id="adminFreeUserCount">-</span></p><p>Usu√°rios Premium: <span id="adminPremiumUserCount">-</span></p></div><hr class="admin-divider"><div class="admin-user-list-container"><h3>Lista de Usu√°rios:</h3><div id="adminUserList" class="admin-user-list"><p>Carregando usu√°rios...</p></div></div></div>
    </div>
  </div>

  <!-- Modal: Upgrade para Premium -->
  <div id="premiumUpgradeModalOverlay" class="modal-overlay">
    <div class="modal-container premium-upgrade-modal-container">
      <div class="modal-header"><span><i class="fas fa-rocket"></i> Desbloqueie Mem√≥rias Ilimitadas!</span><button class="modal-close-btn" onclick="closePremiumUpgradeModal()"><i class="fas fa-times"></i></button></div>
      <div class="modal-content premium-upgrade-modal-content"><i class="fas fa-gem" style="font-size:3.5em;color:#8b4513;text-align:center;display:block;margin-bottom:20px;"></i><h3>Voc√™ atingiu o limite de 20 mem√≥rias gratuitas!</h3><p>Com o plano Premium, voc√™ pode registrar quantas mem√≥rias quiser, sem limites!</p><p>Apenas R$4,99 por m√™s!</p><div class="modal-button-group"><button onclick="handlePremiumPurchase()" class="add-btn premium-purchase-btn"><i class="fas fa-credit-card"></i> Quero ser Premium!</button><button onclick="closePremiumUpgradeModal()" class="cancel-btn">Fechar</button></div><p id="premiumPurchaseInfo" style="display:none;">A integra√ß√£o com o sistema de pagamento estar√° dispon√≠vel em breve!</p></div>
    </div>
  </div>

  <!-- Modal: Gerenciar Tipos de Tema -->
  <div id="manageThemeTypesModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:600px;"><div class="modal-header"><span><i class="fas fa-palette"></i> Gerenciar Tipos de Tema</span><button class="modal-close-btn" onclick="closeManageThemeTypesModal()"><i class="fas fa-times"></i></button></div><div class="modal-content"><button id="openAddThemeTypeModalBtn" class="add-btn"><i class="fas fa-plus"></i> Adicionar Novo Tipo de Tema</button><div id="themeTypesListContainer"><p>Carregando...</p></div><div class="modal-button-group" style="margin-top:20px;"><button onclick="closeManageThemeTypesModal()" class="cancel-btn" style="flex-grow:0.5;">Fechar</button></div></div></div>
  </div>

  <!-- Modal: Gerenciar Subtemas -->
  <div id="manageSubthemesModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:600px;"><div class="modal-header"><span id="manageSubthemesModalTitle"><i class="fas fa-stream"></i> Gerenciar Subtemas</span><button class="modal-close-btn" onclick="closeManageSubthemesModal()"><i class="fas fa-times"></i></button></div><div class="modal-content"><div class="add-item-form"><input type="text" id="newSubthemeNameInput" placeholder="Nome do novo subtema..."><button id="addSubthemeBtn"><i class="fas fa-plus"></i> Adicionar</button></div><div id="subthemesListContainer"><p>Carregando...</p></div><div class="modal-button-group" style="margin-top:20px;"><button onclick="closeManageSubthemesModal()" class="cancel-btn" style="flex-grow:0.5;">Fechar</button></div></div></div>
  </div>

  <!-- Modal: Editar Nome do Subtema -->
  <div id="editSubthemeModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:500px;">
      <div class="modal-header">
        <span id="editSubthemeModalTitle"><i class="fas fa-edit"></i> Editar Nome do Subtema</span>
        <button class="modal-close-btn" onclick="closeEditSubthemeModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-content">
        <input type="hidden" id="editingSubthemeId" value="">
        <label for="editSubthemeNameInput">Novo nome:</label>
        <input type="text" id="editSubthemeNameInput" placeholder="Digite o novo nome...">
        <div class="modal-button-group">
          <button onclick="closeEditSubthemeModal()" class="cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
          <button id="saveSubthemeNameBtn" class="add-btn"><i class="fas fa-save"></i> Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Editar/Adicionar Tipo de Tema -->
  <div id="themeTypeEditModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:500px;"><div class="modal-header"><span id="themeTypeEditModalTitle">Adicionar Tipo de Tema</span><button class="modal-close-btn" onclick="closeThemeTypeEditModal()"><i class="fas fa-times"></i></button></div><div class="modal-content"><input type="hidden" id="editingThemeTypeId" value=""><label for="themeTypeNameInput">Nome do Tipo de Tema:</label><input type="text" id="themeTypeNameInput" placeholder="Ex: Receitas, Projetos Fitness"><label>√çcone:</label><div id="themeTypeIconGrid"></div><input type="hidden" id="selectedThemeTypeIcon" value="fa-folder"><label>Cor dos Post-its:</label><div id="themeTypeColorPalette"></div><input type="hidden" id="selectedThemeTypeColor" value="default-yellow"><div class="modal-button-group"><button onclick="closeThemeTypeEditModal()" class="cancel-btn"><i class="fas fa-times"></i> Cancelar</button><button id="saveThemeTypeBtn" class="add-btn"><i class="fas fa-save"></i> Salvar Tipo</button></div></div></div>
  </div>

  <!-- Modal: Gerenciar Abas Pessoais -->
  <div id="managePersonalTabsModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:600px;"><div class="modal-header"><span><i class="fas fa-user-cog"></i> Gerenciar Minhas Abas Pessoais</span><button class="modal-close-btn" onclick="closeManagePersonalTabsModal()"><i class="fas fa-times"></i></button></div><div class="modal-content"><button id="openAddPersonalTabModalBtn" class="add-btn"><i class="fas fa-plus"></i> Adicionar Nova Aba Pessoal</button><div id="personalTabsListContainer"><p>Carregando...</p></div><div class="modal-button-group" style="margin-top:20px;"><button onclick="closeManagePersonalTabsModal()" class="cancel-btn" style="flex-grow:0.5;">Fechar</button></div></div></div>
  </div>

  <!-- Modal: Editar/Adicionar Aba Pessoal -->
  <div id="personalTabEditModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:500px;"><div class="modal-header"><span id="personalTabEditModalTitle">Adicionar Nova Aba</span><button class="modal-close-btn" onclick="closePersonalTabEditModal()"><i class="fas fa-times"></i></button></div><div class="modal-content"><input type="hidden" id="editingPersonalTabId" value=""><label for="personalTabNameInput">Nome da Aba (Emojis üéâ):</label><input type="text" id="personalTabNameInput" placeholder="Ex: Meus Projetos üöÄ"><label>Cor do Post-it:</label><div id="personalTabColorPalette"></div><input type="hidden" id="selectedPersonalTabColor" value=""><label>√çcone da Aba:</label><div id="personalTabIconGrid"></div><input type="hidden" id="selectedPersonalTabIcon" value="fas fa-sticky-note"><div class="modal-button-group"><button onclick="closePersonalTabEditModal()" class="cancel-btn"><i class="fas fa-times"></i> Cancelar</button><button id="savePersonalTabBtn" class="add-btn"><i class="fas fa-save"></i> Salvar Aba</button></div></div></div>
  </div>

  <!-- Modal: Resumo da Aba/Tema -->
  <div id="summaryModalOverlay" class="modal-overlay">
    <div class="modal-container" style="max-width:700px;"><div class="modal-header"><span id="summaryModalTitle"><i class="fas fa-file-alt"></i> Resumo da Aba</span><button class="modal-close-btn" onclick="closeSummaryModal()"><i class="fas fa-times"></i></button></div><div class="modal-content"><div id="summaryContent"></div><div class="modal-button-group"><button onclick="copySummaryToClipboard()" class="add-btn" id="copySummaryBtn"><i class="fas fa-copy"></i> Copiar Conte√∫do</button><button onclick="closeSummaryModal()" class="cancel-btn">Fechar</button></div></div></div>
  </div>


  <!-- =============================================================================== -->
  <!-- SCRIPTS DA APLICA√á√ÉO                                                            -->
  <!-- =============================================================================== -->
  <!-- O atributo `defer` garante que o HTML seja completamente carregado e parseado -->
  <!-- antes que o navegador execute estes scripts. A ordem de importa√ß√£o √©       -->
  <!-- importante, pois os scripts podem ter depend√™ncias entre si.                -->
  <script src="scripts/state.js" defer></script>
  <script src="scripts/firebase-config.js" defer></script>
  <script src="scripts/ui.js" defer></script>
  <script src="scripts/theme-manager.js" defer></script>
  <script src="scripts/app.js" defer></script>
  <script src="scripts/auth.js" defer></script>

  <!-- Script inline para registrar o Service Worker. -->
  <script>
    // Verifica se o navegador suporta Service Workers.
    if ('serviceWorker' in navigator) {
      // O registro √© feito ap√≥s o carregamento completo da p√°gina.
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch(error => {
            console.log('Falha ao registrar Service Worker:', error);
          });
      });
    }
  </script>
</body>
</html>
